# TableCheck

**Prototype for table availability check**

## Up and running

1. Install erlang and elixir versions from [tool versions file](./.tool-versions).

2. Ensure your Postgres is running and accesable on localhost:5432 with default creds

3. Fetch deps: 

```sh
mix deps.get
```

4. Create database, migrate it and seed data

```sh
mix ecto.reset
```

5. Start application with iex console:

```sh
iex -S mix
```

## Description and assumptations

[Database schema](./db_schema.png)

### Entities

#### Restaurant

Restaurant entity itself. Has unique autogenerated id and required name. 
In prototype we assume that all restaurants have the same business hours 
for every day of the week: from 5 00 PM to 12 00 AM

#### Tables

Table entity. Has unique autogenerated id and required capacity and id of restaurant fields.

Table capacity is the number of people that can sit at this table. In prototype
we constraint capacity with max value of 4.

#### Guests

Entity represents required information about person who reserves a table: name, phone, email. Also specific guest is linked to specific restaurant. We assume guest uniqueness by restaurant and phone number.

#### Reservations

Entity represents table reservation for specific date and specific time. Has required status, date, start_at, end_at, table_id, guest_id fields.

Reservation status can be one of pending, paid, cancelled, completed.

### Logic

#### List restaurant availability

Input params:

- `restaurant_id`: required, id of restaurant for which we quering table availability map
- `date`: required, date of reservation
- `min_time`: required, time when guests plan to arrive
- `max_time`: required, time when guests plan to finish dining

#### Creating reservation

Input parameters: 

- `table_id`: required, id of table for which create reservation
- `date`: required, date of reservation
- `start_at`: required, time when guests plan to arrive
- `end_at`: required, time when guests plan to finish dining
- `guest`: required, map of guest related info fields

1. Fetch table
2. Validate that start_at, end_at are in business hours range
3. Upsert restaurant guest by phone
4. Build and save reservation for table
